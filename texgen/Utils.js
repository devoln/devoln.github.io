var ChromeVersion=function(){var b=navigator.userAgent.match(/Chrom(e|ium)\/(\d+)\./);return b?parseInt(b[2],10):null}(),BrowserIsIE=navigator.userAgent.match(/Trident/g)||navigator.userAgent.match(/MSIE/g),TemplateStringSupport=!1;try{new Function('`{2+2}`'),TemplateStringSupport=!0}catch(b){}String.prototype.startsWith||Object.defineProperty(String.prototype,'startsWith',{enumerable:!1,configurable:!1,writable:!1,value:function(b,c){return c=c||0,this.indexOf(b,c)===c}}),'function'!=typeof String.prototype.endsWith&&(String.prototype.endsWith=function(b){return-1!==this.indexOf(b,this.length-b.length)});function Base64ToBuffer(b){var c=atob(b),d=new Uint8Array(c.length);return Array.prototype.forEach.call(c,function(e,f){d[f]=e.charCodeAt(0)}),d}HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,'toBlob',{value:function(b,c,d){if(HTMLCanvasElement.prototype.msToBlob&&(!c||'image/png'===c))return void b(this.msToBlob());var e=this.toDataURL(c,d).split(',')[1];b(new Blob([Base64ToBuffer(e)],{type:c||'image/png'}))}});function ReplaceTextAreaWithAce(b,c,d){var e=document.createElement('div');e.style.position='relative',e.style.width=parseFloat(getComputedStyle(b).getPropertyValue('width')),e.style.height=parseFloat(getComputedStyle(b).getPropertyValue('height')),b.parentNode.insertBefore(e,b);var f=ace.edit(e);f.commands.bindKeys({'ctrl-l':null}),f.$blockScrolling=Infinity,f.setShowPrintMargin(!1),f.getSession().setValue(b.value),f.getSession().setMode('ace/mode/'+c),f.setOptions({enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0});return f.completers.unshift({getCompletions:function(h,j,k,l,m){f==h&&m(null,d.map(function(n){var o=n[0];return null!=n[1]&&(o+='('+n[1].join(', ')+')'),{caption:o,value:n[0]+(null==n[1]?'':'('),meta:null==n[1]?'parameter':'function'}}))}}),f.completer||(f.execCommand('startAutocomplete'),f.completer.detach()),f.completer.popup.container.style.width='60%',b.parentNode.removeChild(b),f}function DBInsert(b,c,d){var e=new XMLHttpRequest;e.open('POST','https://api.scorocode.ru/api/v1/data/insert',!0),e.setRequestHeader('Content-Type','application/json'),e.onreadystatechange=function(){if(4==this.readyState){if(200!=e.status)return void alert('Error inserting to DB:\nstatus: '+e.status+': '+e.statusText);var g=JSON.parse(e.responseText);return g.error?void(g.result&&g.result.startsWith('ALREADY_EXISTS_ID:')?(g.result={_id:g.result.substr(18),duplicate:!0},d(g.result)):alert('Error inserting to DB:\n'+g.errMsg+'\nresult: '+g.result)):void(g.result.duplicate=!1,d(g.result))}},e.send(JSON.stringify({app:'815d6c32a3884ee5b7382faf349138b0',cli:'e95b39465c1a4fcdbcf4da2dd08736e5',coll:b,doc:c}))}function DBReadById(b,c,d,e){DBQuery(b,{_id:{$eq:c}},function(f){f[0]!==void 0&&e(f[0])},{fields:d,limit:1})}function DBQuery(b,c,d,e){var f=new XMLHttpRequest,g={app:'815d6c32a3884ee5b7382faf349138b0',cli:'e95b39465c1a4fcdbcf4da2dd08736e5',coll:b,query:c};e&&(e.limit&&(g.limit=e.limit),e.limit&&(g.skip=e.skip),e.fields&&(g.fields=e.fields)),f.open('POST','https://api.scorocode.ru/api/v1/data/find',!0),f.setRequestHeader('Content-Type','application/json'),f.onreadystatechange=function(){if(4==this.readyState){if(200!=f.status)return void alert('Error querying from DB:\n'+f.status+': '+f.statusText);var h=JSON.parse(f.responseText);return h.error?void alert('Error querying from DB:\n'+f.errMsg):void d(BSON.deserialize(Base64ToBuffer(h.result)))}},f.send(JSON.stringify(g))}function IsEmptyString(b){return!b||''===b.trim()}function EscapeHTML(b){return b.replace(/&/g,'&amp;').replace(/</g,'&lt;').replace(/>/g,'&gt;').replace(/\n/g,'<br/>')}function LoadShaderAsync(b){var c={};if(TemplateStringSupport){var d=document.getElementsByTagName('head')[0],e=document.createElement('script');return e.type='text/javascript',e.async=!0,e.src=b,c=e,d.appendChild(e),c}var f=new XMLHttpRequest;return f.open('GET',b,!0),f.send(),f.onreadystatechange=function(){if(4==f.readyState){if(200!=f.status)return void alert('Couldn\'t load shader library:\n'+f.status+': '+f.statusText);c.code=f.responseText;var g=c.code.indexOf('`',0);if(-1!==g){var h=c.code.indexOf('`',g+1);c.code=c.code.substring(g+1,h)}c.onload&&c.onload()}},c}function CreateBMPInMemory(b,c,d){function e(A){n.setUint16(o,A,!0),o+=2}function f(A){n.setUint32(o,A,!0),o+=4}var h=new Uint32Array(b.buffer),k=4*c*d,l=122+k,m=new ArrayBuffer(l),n=new DataView(m),o=0;return e(19778),f(l),o+=4,f(122),f(108),f(c),f(-d>>>0),e(1),e(32),f(3),f(k),f(2835),f(2835),o+=8,f(255),f(65280),f(16711680),f(4278190080),f(1466527264),new Uint8Array(m,122).set(b),m}function CreateBMPBlob(b,c,d){return new Blob([CreateBMPInMemory(b,c,d)],{type:'image/bmp'})}function CreateImageFromPixels(b,c,d){var e=new Image;e.setAttribute('crossOrigin','Anonymous'),e.crossOrigin='Anonymous';var f=CreateBMPBlob(b,c,d),g=URL.createObjectURL(f);return e.onload=function(){if(ChromeVersion){e.reviveCanvas=document.createElement('canvas');var ctx = e.reviveCanvas.getContext('2d');e.reviveCanvas.width=e.reviveCanvas.height=1,ctx.drawImage(this,0,0,1,1)}URL.revokeObjectURL(g)},e.src=g,e}var SaveBlob=SaveBlob||function(b){'use strict';if(!('undefined'==typeof b||'undefined'!=typeof navigator&&/MSIE [1-9]\./.test(navigator.userAgent))){var c=b.document,d=function(){return b.URL||b.webkitURL||b},e=c.createElementNS('http://www.w3.org/1999/xhtml','a'),g=function(w){var z=new MouseEvent('click');w.dispatchEvent(z)},h=/constructor/i.test(b.HTMLElement)||b.safari,j=/CriOS\/[\d]+/.test(navigator.userAgent),k=function(w){(b.setImmediate||b.setTimeout)(function(){throw w},0)},n=function(w){setTimeout(function(){'string'==typeof w?d().revokeObjectURL(w):w.remove()},40000)},o=function(w,z,A){z=[].concat(z);for(var C,B=z.length;B--;)if(C=w['on'+z[B]],'function'==typeof C)try{C.call(w,A||w)}catch(D){k(D)}},q=function(w){return /^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(w.type)?new Blob([String.fromCharCode(65279),w],{type:w.type}):w},r=function(w,z,A){A||(w=q(w));var E,B=this,C=w.type,D=C==='application/octet-stream',F=function(){o(B,'writestart progress write writeend'.split(' '))};return B.readyState=B.INIT,'download'in e?(E=d().createObjectURL(w),void setTimeout(function(){e.href=E,e.download=z,g(e),F(),n(E),B.readyState=B.DONE})):void function(){if((j||D&&h)&&b.FileReader){var H=new FileReader;return H.onloadend=function(){var J=j?H.result:H.result.replace(/^data:[^;]*;/,'data:attachment/file;'),K=b.open(J,'_blank');K||(b.location.href=J),J=void 0,B.readyState=B.DONE,F()},H.readAsDataURL(w),void(B.readyState=B.INIT)}if(E||(E=d().createObjectURL(w)),D)b.location.href=E;else{var I=b.open(E,'_blank');I||(b.location.href=E)}B.readyState=B.DONE,F(),n(E)}()},t=r.prototype,u=function(w,z,A){return new r(w,z||w.name||'download',A)};return'undefined'!=typeof navigator&&navigator.msSaveOrOpenBlob?function(w,z,A){return z=z||w.name||'download',A||(w=q(w)),navigator.msSaveOrOpenBlob(w,z)}:(t.abort=function(){},t.readyState=t.INIT=0,t.WRITING=1,t.DONE=2,t.error=t.onwritestart=t.onprogress=t.onwrite=t.onabort=t.onerror=t.onwriteend=null,u)}}('undefined'!=typeof self&&self||'undefined'!=typeof window&&window||this.content);'undefined'!=typeof module&&module.exports?module.exports.SaveBlob=SaveBlob:'undefined'!=typeof define&&null!==define&&null!==define.amd&&define('Utils.js',function(){return SaveBlob});function ImageToCanvas(b){var c=b.reviveCanvas?b.reviveCanvas:document.createElement('canvas');c.width=b.width,c.height=b.height;var d=c.getContext('2d');return d.drawImage(b,0,0),[c,d]}function SaveImagePNG(b,c){ImageToCanvas(b)[0].toBlob(function(d){SaveBlob(d,c)},'image/png')}function SaveImageJPEG(b,c,d){ImageToCanvas(b)[0].toBlob(function(e){SaveBlob(e,c)},'image/jpeg',d)}function SaveImageWEBP(b,c,d){ImageToCanvas(b)[0].toBlob(function(e){SaveBlob(e,c)},'image/webp',d)}function SaveImageBMP(b,c){var d=CreateBMPBlob(ImageToCanvas(b)[1].getImageData(0,0,b.width,b.height).data,b.width,b.height);SaveBlob(d,c)}