function EncodeUTF8(r){try{return new TextEncoder("utf-8").encode(r)}catch(r){}for(var e=unescape(encodeURIComponent(r)),n=e.length,t=new Uint8Array(n);n--;)t[n]=e.charCodeAt(n);return t}function DecodeUTF8(r){try{return new TextDecoder("utf-8").decode(bin)}catch(r){}for(var e="",n=0,t=r.length;n<t;n++)e+=String.fromCharCode(r[n]);return decodeURIComponent(escape(e))}function Utf8StrLen(r){return encodeURI(r).split(/%..|./).length-1}var BSON={};!function(){function r(r){var n=5;for(var t in r)n+=e(t,r[t]);return n}function e(e,n){var t=1;if(e&&(t+=strlen(e)+1),void 0===n||null===n)return t;switch(n.constructor){case String:return t+4+strlen(n)+1;case Number:return t+8-4*((0|n)===n);case Boolean:return t+1;case Array:case Object:return t+r(n);case Int8Array:case Uint8Array:return t+5+n.byteLength;case Date:return t+8}return 0}function n(r,e,n){if(n||(n=0),n+=a(e.length,e,n),r.constructor===Array)for(var t=0,c=r.length;t<c;t++)n=u(t.toString(),r[t],e,n);else for(var o in r)n=u(o,r[o],e,n);return e[n++]=0,n}function t(r,e,n){var t=EncodeUTF8(r),a=t.length;return e.set(t,n),e[n+a++]=0,a}function a(r,e,n){return e[n++]=255&r,e[n++]=r>>>8&255,e[n++]=r>>>16&255,e[n++]=r>>>24&255,4}function u(r,e,u,c){var o=c++;if(c+=t(r,u,c),null==e)return u[o]=10,c;switch(e.constructor){case String:u[o]=2;var s=t(e,u,c+4);c+=a(s,u,c)+s;break;case Number:e%1?(u[o]=1,u.set(new Uint8Array(new Float64Array([e]).buffer),c),c+=8):(0|e)===e?(u[o]=16,c+=a(e,u,c)):(u[o]=18,u.set(i(e),c),c+=8);break;case Boolean:u[o]=8,u[c++]=+e;break;case Array:case Object:u[o]=e.constructor===Array?4:3;var f=n(e,u,c);return a(f-c,u,c),f;case Int8Array:case Uint8Array:return u[o]=5,c+=a(e.byteLength,u,c),u[c++]=0,u.set(e,c),c+=e.byteLength;case Date:u[o]=9,u.set(i(e.getTime()),c),c+=8;break;case l:u[o]=7,u.set(e.buffer(),c),c+=12;break;case RegExp:u[o]=11,c+=t(e.source,u,c),e.global&&(u[c++]=115),e.ignoreCase&&(u[c++]=105),e.multiline&&(u[c++]=109),u[c++]=0}return c}function c(r,e){return r[e]|r[e+1]<<8|r[e+2]<<16|r[e+3]<<24}function o(r,e,n){if(e||(e=0),!(r.length<5)){var t=r[e++]|r[e++]<<8|r[e++]<<16|r[e++]<<24;if(!(t<5||t>r.length||r[r.length-1])){for(var a=n?[]:{};;){var u=r[e++];if(!u)break;for(var i=e;r[i]&&i<r.length;)i++;if(i>=r.length-1)return;var y=DecodeUTF8(r.subarray(e,i));n&&(y=parseInt(y)),e=++i;var b=function(){switch(u){case 1:return new Float64Array(r.slice(e,e+=8).buffer)[0];case 2:return t=c(r,e),e+=4,DecodeUTF8(r.subarray(e,(e+=t)-1));case 3:case 4:return t=c(r,e),o(r,(e+=t)-t,4==u);case 5:return t=c(r,e),e+=4,r[e++]-4?r.slice(e,e+=t):t-16?void 0:new f(r.subarray(e,e+=t));case 6:return null;case 7:case 10:return new l(r.subarray(e,e+=12));case 8:return 1===r[e++];case 9:return new Date(s(r.subarray(e,e+=8)));case 11:for(i=e;i<r.length&&r[i++];);if(i>=r.length)return;var n=DecodeUTF8(r.subarray(e,i));for(e=i;i<r.length&&r[i++];);if(i>=r.length)return;var a=DecodeUTF8(r.subarray(e,i));return e=i,new RegExp(n,a);case 16:return c(r,(e+=4)-4);case 18:return s(r.subarray(e,e+=8))}}();if(void 0===b)return;a[y]=b}return a}}}function i(r){var e=new Uint8Array(8);if(r%1)return e.set(new Uint8Array(new Float64Array([r]).buffer)),e;var n=r%4294967296|0,t=r/4294967296|0;return r<0&&(t=0|~(-r/4294967296),(n=(n=0|~(-r%4294967296))+1|0)||t++),a(t,e,a(n,e,0)),e}function s(r,e){e||(e=0);var n=c(r,e);return 4294967296*c(r,e+4)+(n>=0?n:4294967296+n)}var f=function(){function r(r){this._id=new Uint8Array(r)}return r.prototype.buffer=function(){return this._id},r}();BSON.UUID=f;var l=function(){function r(r){this._id=new Uint8Array(r)}return r.prototype.buffer=function(){return this._id},r}();BSON.serialize=function(e){var t=new Uint8Array(r(e));return n(e,t),t},BSON.deserialize=o}();